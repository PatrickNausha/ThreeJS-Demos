let e;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},o={},n=t.parcelRequire1287;null==n&&((n=function(e){if(e in i)return i[e].exports;if(e in o){var t=o[e];delete o[e];var n={id:e,exports:{}};return i[e]=n,t.call(n.exports,n,n.exports),n.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){o[e]=t},t.parcelRequire1287=n);var r=n("eq1Fs"),l={};l=function(){"use strict";var e=function(){var t=0,i=document.createElement("div");function o(e){return i.appendChild(e.dom),e}function n(e){for(var o=0;o<i.children.length;o++)i.children[o].style.display=o===e?"block":"none";t=e}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),n(++t%i.children.length)},!1);var r=(performance||Date).now(),l=r,a=0,s=o(new e.Panel("FPS","#0ff","#002")),d=o(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=o(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:o,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(d.update(e-r,200),l+1e3<=e&&(s.update(1e3*a/(e-l),100),l=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,i){var o=1/0,n=0,r=Math.round,l=r(window.devicePixelRatio||1),a=80*l,s=48*l,d=3*l,c=2*l,p=3*l,h=15*l,f=74*l,u=30*l,w=document.createElement("canvas");w.width=a,w.height=s,w.style.cssText="width:80px;height:48px";var m=w.getContext("2d");return m.font="bold "+9*l+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,a,s),m.fillStyle=t,m.fillText(e,d,c),m.fillRect(p,h,f,u),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(p,h,f,u),{dom:w,update:function(s,g){o=Math.min(o,s),n=Math.max(n,s),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,a,h),m.fillStyle=t,m.fillText(r(s)+" "+e+" ("+r(o)+"-"+r(n)+")",d,c),m.drawImage(w,p+l,h,f-l,u,p,h,f-l,u),m.fillRect(p+f-l,h,l,u),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(p+f-l,h,l,r((1-s/g)*u))}}},e}();const a=new(function(e){return e&&e.__esModule?e.default:e}(l));a.showPanel(0);let s=!1;var d=n("kXZ5p"),c=n("dJCPM");class p{#e=new Map;add(e,t,i,o=!1){if(!e)throw Error("object3d parameter is required");if(!t)throw Error("velocity parameter is required");if(!i)throw Error("angularVelocity parameter is required");this.#e.set(e,{velocity:t,angularVelocity:i,shouldWrap:o})}setAngularVelocity(e,t){let i=this.#e.get(e);if(!i)throw console.error("Unknown object",e),Error("Unknown object");this.#e.set(e,{...i,angularVelocity:t})}setVelocity(e,t){let i=this.#e.get(e);if(!i)throw console.error("Unknown object",e),Error("Unknown object");this.#e.set(e,{...i,velocity:t})}getVelocity(e){let t=this.#e.get(e);if(!t)throw console.error("Unknown object",e),Error("Unknown object");return t.velocity.clone()}step(e,t){let{top:i,bottom:o,left:n,right:r}=t;for(let[t,{velocity:l,angularVelocity:a,shouldWrap:s}]of this.#e){t.rotateX(e*a.x),t.rotateY(e*a.y),t.rotateZ(e*a.z);let d=l.clone().multiplyScalar(e);t.position.add(d),s&&(t.position.x>r?t.position.setX(n):t.position.x<n?t.position.setX(r):t.position.y>i?t.position.setY(o):t.position.y<o&&t.position.setY(i))}}}var r=n("eq1Fs");const h=[new Audio("./assets/audio/explosion-3.wav"),new Audio("./assets/audio/explosion-4.wav"),new Audio("./assets/audio/explosion-3.wav"),new Audio("./assets/audio/explosion-4.wav")];class f{#t=0;#i;#o;#n;#r=0;constructor(e,t,i,o){this.#r=t;let n=e.clone();n.needsUpdate=!0,n.wrapS=n.wrapT=r.RepeatWrapping,this.#i=i,this.#o=o,n.repeat.set(1/this.#i,1/this.#o);let l=new r.SpriteMaterial({map:n,alphaMap:n,blending:r.AdditiveBlending,color:16777215});this.#n=new r.Sprite(l)}getObject3d(){return this.#n}restart(){this.#t=0,this.#n.visible=!0}step(e){if(!this.#n.visible)return;this.#t+=e;let t=Math.floor(this.#t*this.#r),i=this.#o*this.#i;if(t>=i)this.#n.visible=!1;else{let e=t%this.#i,i=Math.floor(t/this.#i),o=this.#n.material.map;o.offset.setX(e/this.#i),o.offset.setY(-(1+i)/this.#o)}}}var r=n("eq1Fs");let u=[],w=[],m=0,g=[],v=0,b=[];function y(e){let t=e.right-e.left,i=e.top-e.bottom;for(let o of w){o.visible=!0;let n=[[(Math.random()-.5)*t,e.top],[(Math.random()-.5)*t,e.bottom],[e.left,(Math.random()-.5)*i],[e.right,(Math.random()-.5)*i]],r=n[Math.floor(Math.random()*n.length)];o.position.set(r[0],r[1],0)}}function x(e,t){let i=g[m%g.length];m++,i.visible=!0,i.position.copy(e);let o=new r.Vector3(30,0,0);o.applyAxisAngle(new r.Vector3(0,0,1),2*Math.PI*Math.random()),t.setVelocity(i,o)}function M(e,t){let i=b[v%b.length];v++,i.visible=!0,i.position.copy(e);let o=new r.Vector3(40,0,0);o.applyAxisAngle(new r.Vector3(0,0,1),2*Math.PI*Math.random()),t.setVelocity(i,o)}const V=4/3,A=new r.WebGLRenderer({antialias:!0});A.outputEncoding=r.sRGBEncoding,A.setClearColor(1118481),A.setPixelRatio(window.devicePixelRatio||1),document.body.appendChild(A.domElement);const T=new r.Scene,S=new p,C=new class{#l=[];#a=0;initialize(e,t,i,o,n){for(let r of(this.#l=Array.from({length:20}).map(()=>new f(t,i,o,n)),this.#l)){let t=r.getObject3d();t.visible=!1,e.add(t)}}explode(e,t){let i=this.#l[this.#a%this.#l.length];i.restart();let o=i.getObject3d();o.position.copy(e),o.scale.set(t,t,1),this.#a++,h[this.#a%h.length].play()}step(e){for(let t of this.#l)t.step(e)}},P=320*V,E=new r.OrthographicCamera(-P/2,P/2,160,-160);E.position.z=100;const z={top:E.top,bottom:E.bottom,left:E.left,right:E.right},R=new(0,d.GLTFLoader)().setPath("./assets/models/");function L(e){return new Promise((t,i)=>{R.load(e,t)})}const j=new(0,r.TextureLoader)().setPath("./assets/textures/");function D(e){return new Promise((t,i)=>{j.load(e,t)})}let k=null;!async function(){let[e,t,i,o]=await Promise.all([L("asteroids-spacecraft.gltf"),L("asteroids-scene.gltf"),D("explosion-sprite.png"),D("laser-sprite.png")]);k=e.scene,T.add(k),S.add(k,new r.Vector3(0,0,0),new r.Vector3(0,0,0)),C.initialize(T,i,30,4,4),function(e,t,i){let o=e.scene.children.filter(({userData:e})=>e.name.startsWith("asteroid-large-")),n=e.scene.children.filter(({userData:e})=>e.name.startsWith("asteroid-small-")),l=e.scene.children.filter(({userData:e})=>e.name.startsWith("asteroid-smaller-"));w=Array.from({length:6}).map((e,n)=>{let l=o[n%o.length].clone();i.add(l),l.visible=!1;let a=new r.Vector3(20,0,0);return a.applyAxisAngle(new r.Vector3(0,0,1),2*Math.PI*Math.random()),t.add(l,a,new r.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),!0),l}),g=Array.from({length:12}).map((e,o)=>{let l=n[o%n.length].clone();return i.add(l),l.visible=!1,t.add(l,new r.Vector3(0,0,0),new r.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),!0),l}),u=[...b=Array.from({length:24}).map((e,o)=>{let n=l[o%l.length].clone();return i.add(n),n.visible=!1,t.add(n,new r.Vector3(0,0,0),new r.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),!0),n}),...g,...w]}(t,S,T),y(z),function(e){for(let t of(q.push(...Array.from({length:10}).map(()=>{let t=new r.SpriteMaterial({map:e,alphaMap:e,blending:r.AdditiveBlending,color:16777215}),i=new r.Sprite(t);return i.visible=!1,i})),q))t.scale.set(8,8,1),T.add(t),S.add(t,new r.Vector3(0,0,0),new r.Vector3(0,0,0))}(o)}();const I={debugLights:!0,light0:!0,light1:!0,light2:!0,animateLights:!0,model:"sphere"},U=new c.GUI;U.add(I,"light0").onChange(e=>{H.visible=e}),U.add(I,"light1").onChange(e=>{X.visible=e}),U.add(I,"light2").onChange(e=>{B.visible=e}),(s=!s)?document.body.appendChild(a.dom):a.dom.remove();const q=[],O=320/1.5,W={0:64,1:48,2:24},F={};window.document.addEventListener("keydown",e=>{F[e.code]=!0}),window.document.addEventListener("keyup",e=>{F[e.code]=!1});const H=new r.DirectionalLight(16777215,1);H.position.set(1,1,2),T.add(H);const B=new r.DirectionalLight(16742144,.5);B.position.set(1,-2,.5),T.add(B);const X=new r.DirectionalLight(30719,.5);X.position.set(-1,1,.5),T.add(X),function t(i){let o=i-e;if(requestAnimationFrame(t),k){if(e){let e=o;for(;e>0;){let t=Math.min(10,e);(function(e){if(u.some(e=>e.visible)||y(z),k.visible&&(F.ArrowLeft?S.setAngularVelocity(k,new r.Vector3(0,0,3)):F.ArrowRight?S.setAngularVelocity(k,new r.Vector3(0,0,-3)):S.setAngularVelocity(k,new r.Vector3(0,0,0)),F.Space)){let e=new r.Vector3(0,5,-1);e.applyMatrix4(k.matrix),function(e,t){if(Y)return;Y=!0,setTimeout(()=>{Y=!1},250);let i=new r.Vector3(0,O,0);i.applyEuler(t),q[G].position.copy(e),q[G].material.rotation=t.z,q[G].visible=!0,S.setVelocity(q[G],i),G=(G+1)%q.length,_&&(_.pause(),_.currentTime=0,_.play())}(e,k.rotation.clone())}for(let t of(S.step(e,z),C.step(e),q.filter(({visible:e})=>e))){let e=function(e,t){let i=u.filter(({visible:e})=>e),o=t.clone().normalize(),n=new(0,r.Vector3)().subVectors(e,o),l=new r.Raycaster(n,o,0,2),a=l.intersectObjects(i);return a}(t.position,S.getVelocity(t));for(let{object:i}of(e.length&&(t.position.set(0,0,0),t.visible=!1,S.setVelocity(t,new r.Vector3(0,0,0))),e)){let e=(i.visible=!1,w.includes(i))?(x(i.position.clone(),S),x(i.position.clone(),S),0):g.includes(i)?(M(i.position.clone(),S),M(i.position.clone(),S),1):2,t=i.position.clone();t.setZ(10),C.explode(t,W[e])}}k.visible&&function(e){for(let t of u.filter(({visible:e})=>e))if(10>e.distanceTo(t.position))return!0;return!1}(k.position)&&(C.explode(k.position,32),k.visible=!1)})(t/1e3),e-=t}}A.render(T,E),a.update(),e=i}}();let G=0,Y=!1;const _=new Audio("./assets/audio/laser-noise-2.wav");function N(){let e=window.innerHeight,t=window.innerHeight*V;A.setSize(t,e),E.aspect=window.innerWidth/window.innerHeight,E.updateProjectionMatrix()}N(),window.addEventListener("resize",N);
//# sourceMappingURL=asteroids.9e6bbbc1.js.map
