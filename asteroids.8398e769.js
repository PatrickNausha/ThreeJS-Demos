!function(){let e;var t,i,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},l={},r=o.parcelRequire1287;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in l){var t=l[e];delete l[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){l[e]=t},o.parcelRequire1287=r);var a=r("6OvZu"),s={};(t=function(){var e=0,i=document.createElement("div");function o(e){return i.appendChild(e.dom),e}function n(t){for(var o=0;o<i.children.length;o++)i.children[o].style.display=o===t?"block":"none";e=t}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),n(++e%i.children.length)},!1);var l=(performance||Date).now(),r=l,a=0,s=o(new t.Panel("FPS","#0ff","#002")),d=o(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=o(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:o,showPanel:n,begin:function(){l=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(d.update(e-l,200),r+1e3<=e&&(s.update(1e3*a/(e-r),100),r=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){l=this.end()},domElement:i,setMode:n}}).Panel=function(e,t,i){var o=1/0,n=0,l=Math.round,r=l(window.devicePixelRatio||1),a=80*r,s=48*r,d=3*r,c=2*r,p=3*r,h=15*r,f=74*r,u=30*r,w=document.createElement("canvas");w.width=a,w.height=s,w.style.cssText="width:80px;height:48px";var m=w.getContext("2d");return m.font="bold "+9*r+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,a,s),m.fillStyle=t,m.fillText(e,d,c),m.fillRect(p,h,f,u),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(p,h,f,u),{dom:w,update:function(s,g){o=Math.min(o,s),n=Math.max(n,s),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,a,h),m.fillStyle=t,m.fillText(l(s)+" "+e+" ("+l(o)+"-"+l(n)+")",d,c),m.drawImage(w,p+r,h,f-r,u,p,h,f-r,u),m.fillRect(p+f-r,h,r,u),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(p+f-r,h,r,l((1-s/g)*u))}}},s=t;let d=new((i=s)&&i.__esModule?i.default:i);d.showPanel(0);let c=!1;var p=r("53OwP"),h=r("dUO1w");class f{#e=new Map;add(e,t,i,o=!1,n=!1){if(!e)throw Error("object3d parameter is required");if(!t)throw Error("velocity parameter is required");if(!i)throw Error("angularVelocity parameter is required");this.#e.set(e,{velocity:t,angularVelocity:i,shouldWrap:o,hasDrag:n})}setAngularVelocity(e,t){let i=this.#e.get(e);if(!i)throw console.error("Unknown object",e),Error("Unknown object");this.#e.set(e,{...i,angularVelocity:t})}setVelocity(e,t){let i=this.#e.get(e);if(!i)throw console.error("Unknown object",e),Error("Unknown object");this.#e.set(e,{...i,velocity:t})}accelerate(e,t){let i=this.#e.get(e);if(!i)throw console.error("Unknown object",e),Error("Unknown object");i.velocity.add(t)}getVelocity(e){let t=this.#e.get(e);if(!t)throw console.error("Unknown object",e),Error("Unknown object");return t.velocity.clone()}step(e,t){let{top:i,bottom:o,left:n,right:l}=t;for(let[t,{velocity:r,angularVelocity:a,shouldWrap:s,hasDrag:d}]of this.#e){if(d){let t=r.clone().negate().multiplyScalar(.4*e);r.add(t)}t.rotateX(e*a.x),t.rotateY(e*a.y),t.rotateZ(e*a.z);let c=r.clone().multiplyScalar(e);t.position.add(c),s&&(t.position.x>l?t.position.setX(n):t.position.x<n?t.position.setX(l):t.position.y>i?t.position.setY(o):t.position.y<o&&t.position.setY(i))}}}var a=r("6OvZu");let u=[new Audio("./assets/audio/explosion-3.wav"),new Audio("./assets/audio/explosion-4.wav"),new Audio("./assets/audio/explosion-3.wav"),new Audio("./assets/audio/explosion-4.wav")];class w{#t=0;#i;#o;#n;#l=0;constructor(e,t,i,o){this.#l=t;let n=e.clone();n.needsUpdate=!0,n.wrapS=n.wrapT=a.RepeatWrapping,this.#i=i,this.#o=o,n.repeat.set(1/this.#i,1/this.#o);let l=new a.SpriteMaterial({map:n,alphaMap:n,blending:a.AdditiveBlending,color:16777215});this.#n=new a.Sprite(l)}getObject3d(){return this.#n}restart(){this.#t=0,this.#n.visible=!0}step(e){if(!this.#n.visible)return;this.#t+=e;let t=Math.floor(this.#t*this.#l),i=this.#o*this.#i;if(t>=i)this.#n.visible=!1;else{let e=t%this.#i,i=Math.floor(t/this.#i),o=this.#n.material.map;o.offset.setX(e/this.#i),o.offset.setY(-(1+i)/this.#o)}}}var a=r("6OvZu");let m=[],g=[],v=0,b=[],y=0,x=[];function M(e){let t=e.right-e.left,i=e.top-e.bottom;for(let o of g){o.visible=!0;let n=[[(Math.random()-.5)*t,e.top],[(Math.random()-.5)*t,e.bottom],[e.left,(Math.random()-.5)*i],[e.right,(Math.random()-.5)*i]],l=n[Math.floor(Math.random()*n.length)];o.position.set(l[0],l[1],0)}}function V(e,t){let i=b[v%b.length];v++,i.visible=!0,i.position.copy(e);let o=new a.Vector3(30,0,0);o.applyAxisAngle(new a.Vector3(0,0,1),2*Math.PI*Math.random()),t.setVelocity(i,o)}function A(e,t){let i=x[y%x.length];y++,i.visible=!0,i.position.copy(e);let o=new a.Vector3(40,0,0);o.applyAxisAngle(new a.Vector3(0,0,1),2*Math.PI*Math.random()),t.setVelocity(i,o)}let T=4/3,S=new a.WebGLRenderer({antialias:!0});S.outputEncoding=a.sRGBEncoding,S.setClearColor(1118481),S.setPixelRatio(window.devicePixelRatio||1),document.body.appendChild(S.domElement);let E=new a.Scene,C=new f,P=new class{#r=[];#a=0;initialize(e,t,i,o,n){for(let l of(this.#r=Array.from({length:20}).map(()=>new w(t,i,o,n)),this.#r)){let t=l.getObject3d();t.visible=!1,e.add(t)}}explode(e,t){let i=this.#r[this.#a%this.#r.length];i.restart();let o=i.getObject3d();o.position.copy(e),o.scale.set(t,t,1),this.#a++,u[this.#a%u.length].play()}step(e){for(let t of this.#r)t.step(e)}},z=320*T,R=new a.OrthographicCamera(-z/2,z/2,160,-160);R.position.z=100;let j={top:R.top,bottom:R.bottom,left:R.left,right:R.right},L=new(0,p.GLTFLoader)().setPath("./assets/models/");function D(e){return new Promise((t,i)=>{L.load(e,t)})}let O=new(0,a.TextureLoader)().setPath("./assets/textures/");function U(e){return new Promise((t,i)=>{O.load(e,t)})}let k=null;!async function(){let[e,t,i,o]=await Promise.all([D("asteroids-spacecraft.gltf"),D("asteroids-scene.gltf"),U("explosion-sprite.png"),U("laser-sprite.png")]);k=e.scene,E.add(k),C.add(k,new a.Vector3(0,0,0),new a.Vector3(0,0,0),!0,!0),P.initialize(E,i,30,4,4),function(e,t,i){let o=e.scene.children.filter(({userData:e})=>e.name.startsWith("asteroid-large-")),n=e.scene.children.filter(({userData:e})=>e.name.startsWith("asteroid-small-")),l=e.scene.children.filter(({userData:e})=>e.name.startsWith("asteroid-smaller-"));g=Array.from({length:6}).map((e,n)=>{let l=o[n%o.length].clone();i.add(l),l.visible=!1;let r=new a.Vector3(20,0,0);return r.applyAxisAngle(new a.Vector3(0,0,1),2*Math.PI*Math.random()),t.add(l,r,new a.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),!0),l}),b=Array.from({length:12}).map((e,o)=>{let l=n[o%n.length].clone();return i.add(l),l.visible=!1,t.add(l,new a.Vector3(0,0,0),new a.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),!0),l}),m=[...x=Array.from({length:24}).map((e,o)=>{let n=l[o%l.length].clone();return i.add(n),n.visible=!1,t.add(n,new a.Vector3(0,0,0),new a.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),!0),n}),...b,...g]}(t,C,E),M(j),function(e){for(let t of(q.push(...Array.from({length:10}).map(()=>{let t=new a.SpriteMaterial({map:e,alphaMap:e,blending:a.AdditiveBlending,color:16777215}),i=new a.Sprite(t);return i.visible=!1,i})),q))t.scale.set(8,8,1),E.add(t),C.add(t,new a.Vector3(0,0,0),new a.Vector3(0,0,0))}(o)}();let I={debugLights:!0,light0:!0,light1:!0,light2:!0,animateLights:!0,model:"sphere"},W=new h.GUI;W.add(I,"light0").onChange(e=>{F.visible=e}),W.add(I,"light1").onChange(e=>{X.visible=e}),W.add(I,"light2").onChange(e=>{G.visible=e}),(c=!c)?document.body.appendChild(d.dom):d.dom.remove();let q=[],H=320/1.5,B={0:64,1:48,2:24},Z={};window.document.addEventListener("keydown",e=>{Z[e.code]=!0}),window.document.addEventListener("keyup",e=>{Z[e.code]=!1});let F=new a.DirectionalLight(16777215,1);F.position.set(1,1,2),E.add(F);let G=new a.DirectionalLight(16742144,.5);G.position.set(1,-2,.5),E.add(G);let X=new a.DirectionalLight(30719,.5);X.position.set(-1,1,.5),E.add(X),function t(i){let o=Math.min(i-e,100);if(requestAnimationFrame(t),k){if(e){let e=o;for(;e>0;){let t=Math.min(10,e);(function(e){if(m.some(e=>e.visible)||M(j),k.visible){if(Z.ArrowLeft?C.setAngularVelocity(k,new a.Vector3(0,0,3)):Z.ArrowRight?C.setAngularVelocity(k,new a.Vector3(0,0,-3)):C.setAngularVelocity(k,new a.Vector3(0,0,0)),Z.ArrowUp){let t=new a.Vector3(0,40*e,0);t.applyEuler(k.rotation),C.accelerate(k,t)}if(Z.Space){let e=new a.Vector3(0,5,-1);e.applyMatrix4(k.matrix),function(e,t){if(_)return;_=!0,setTimeout(()=>{_=!1},250);let i=new a.Vector3(0,H,0);i.applyEuler(t),q[Y].position.copy(e),q[Y].material.rotation=t.z,q[Y].visible=!0,C.setVelocity(q[Y],i),Y=(Y+1)%q.length,N&&(N.pause(),N.currentTime=0,N.play())}(e,k.rotation.clone())}}for(let t of(C.step(e,j),P.step(e),q.filter(({visible:e})=>e))){let e=function(e,t){let i=m.filter(({visible:e})=>e),o=i.filter(({position:t})=>20>e.distanceTo(t)),n=t.clone().normalize(),l=new(0,a.Vector3)().subVectors(e,n),r=new a.Raycaster(l,n,0,2),s=r.intersectObjects(o);return s}(t.position,C.getVelocity(t));for(let{object:i}of(e.length&&(t.position.set(0,0,0),t.visible=!1,C.setVelocity(t,new a.Vector3(0,0,0))),e)){let e=(i.visible=!1,g.includes(i))?(V(i.position.clone(),C),V(i.position.clone(),C),0):b.includes(i)?(A(i.position.clone(),C),A(i.position.clone(),C),1):2,t=i.position.clone();t.setZ(10),P.explode(t,B[e])}}k.visible&&function(e){for(let t of m.filter(({visible:e})=>e))if(10>e.distanceTo(t.position))return!0;return!1}(k.position)&&(P.explode(k.position,32),k.visible=!1)})(t/1e3),e-=t}}S.render(E,R),d.update(),e=i}}();let Y=0,_=!1,N=new Audio("./assets/audio/laser-noise-2.wav");function J(){let e=window.innerHeight,t=window.innerHeight*T;S.setSize(t,e),R.aspect=window.innerWidth/window.innerHeight,R.updateProjectionMatrix()}J(),window.addEventListener("resize",J)}();
//# sourceMappingURL=asteroids.8398e769.js.map
